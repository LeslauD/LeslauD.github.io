<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.99.1" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />

    <title>Hadoop :: 刘顿的博客</title>

    
    <link href="/css/nucleus.css?1659414501" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1659414501" rel="stylesheet">
    <link href="/css/hybrid.css?1659414501" rel="stylesheet">
    <link href="/css/featherlight.min.css?1659414501" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1659414501" rel="stylesheet">
    <link href="/css/auto-complete.css?1659414501" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1659414501" rel="stylesheet">
    <link href="/css/theme.css?1659414501" rel="stylesheet">
    <link href="/css/tabs.css?1659414501" rel="stylesheet">
    <link href="/css/hugo-theme.css?1659414501" rel="stylesheet">
    
    <link href="/css/theme-blue.css?1659414501" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1659414501"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/bigdata/hadoop/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <img src="/images/keeprush.png">

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1659414501"></script>
<script type="text/javascript" src="/js/auto-complete.js?1659414501"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/example.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1659414501"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/resume/" title="个人简历" class="dd-item
        
        
        
        ">
      <a href="/resume/">
          <b></b>个人简历
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/photograph/" title="摄影" class="dd-item
        
        
        
        ">
      <a href="/photograph/">
          <b></b>摄影
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/algorithm/" title="数据结构与算法" class="dd-item
        
        
        
        ">
      <a href="/algorithm/">
          <b></b>数据结构与算法
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/algorithm/leetcode/" title="LeetCode" class="dd-item
        
        
        
        ">
      <a href="/algorithm/leetcode/">
          LeetCode
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/algorithm/newcoder/" title="NewCoder" class="dd-item
        
        
        
        ">
      <a href="/algorithm/newcoder/">
          NewCoder
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/algorithm/pat/" title="PAT" class="dd-item
        
        
        
        ">
      <a href="/algorithm/pat/">
          PAT
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/algorithm/tooffer/" title="剑指Offer" class="dd-item
        
        
        
        ">
      <a href="/algorithm/tooffer/">
          剑指Offer
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/algorithm/datastruct/" title="数据结构" class="dd-item
        
        
        
        ">
      <a href="/algorithm/datastruct/">
          数据结构
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/machinelearning/" title="机器学习" class="dd-item
        
        
        
        ">
      <a href="/machinelearning/">
          <b></b>机器学习
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/machinelearning/recommendedsystem/" title="RecommendedSystem" class="dd-item
        
        
        
        ">
      <a href="/machinelearning/recommendedsystem/">
          RecommendedSystem
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/deeplearning/" title="深度学习" class="dd-item
        
        
        
        ">
      <a href="/deeplearning/">
          <b></b>深度学习
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/deeplearning/tensorflow/" title="TensorFlow" class="dd-item
        
        
        
        ">
      <a href="/deeplearning/tensorflow/">
          TensorFlow
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deeplearning/basic/" title="基础算法理论" class="dd-item
        
        
        
        ">
      <a href="/deeplearning/basic/">
          基础算法理论
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vehicle/" title="车车" class="dd-item
        
        
        
        ">
      <a href="/vehicle/">
          <b></b>车车
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/vehicle/santana/" title="1:18 Santana" class="dd-item
        
        
        
        ">
      <a href="/vehicle/santana/">
          1:18 Santana
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/piano/" title="钢琴" class="dd-item
        
        
        
        ">
      <a href="/piano/">
          <b></b>钢琴
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/piano/summer/" title="summer" class="dd-item
        
        
        
        ">
      <a href="/piano/summer/">
          <b></b>summer
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/piano/cannon/" title="卡农" class="dd-item
        
        
        
        ">
      <a href="/piano/cannon/">
          <b></b>卡农
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/piano/basic/" title="基本乐理" class="dd-item
        
        
        
        ">
      <a href="/piano/basic/">
          <b></b>基本乐理
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/piano/sunrise/" title="太阳照常升起" class="dd-item
        
        
        
        ">
      <a href="/piano/sunrise/">
          <b></b>太阳照常升起
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/piano/littlestar/" title="小星星变奏曲" class="dd-item
        
        
        
        ">
      <a href="/piano/littlestar/">
          <b></b>小星星变奏曲
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/programs/" title="项目" class="dd-item
        
        
        
        ">
      <a href="/programs/">
          <b></b>项目
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/programs/bodyassessment/" title="BodyAssessment" class="dd-item
        
        
        
        ">
      <a href="/programs/bodyassessment/">
          <b></b>BodyAssessment
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/programs/bodyassessment/imageprocess/" title="ImageProcess" class="dd-item
        
        
        
        ">
      <a href="/programs/bodyassessment/imageprocess/">
          ImageProcess
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/programs/joyyourmind/" title="JoyYourMind" class="dd-item
        
        
        
        ">
      <a href="/programs/joyyourmind/">
          <b></b>JoyYourMind
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/programs/millenniumtemple/" title="MillenniumTemple" class="dd-item
        
        
        
        ">
      <a href="/programs/millenniumtemple/">
          <b></b>MillenniumTemple
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/cxx/" title="CPP" class="dd-item
        
        
        
        ">
      <a href="/cxx/">
          <b></b>CPP
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/cxx/clang/" title="C language" class="dd-item
        
        
        
        ">
      <a href="/cxx/clang/">
          C language
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/cxx/cpp/" title="CPP" class="dd-item
        
        
        
        ">
      <a href="/cxx/cpp/">
          CPP
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/bigdata/" title="大数据" class="dd-item
        parent
        
        
        ">
      <a href="/bigdata/">
          <b></b>大数据
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/bigdata/hadoop/" title="Hadoop" class="dd-item
        parent
        active
        
        ">
      <a href="/bigdata/hadoop/">
          Hadoop
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/bigdata/spark/" title="Spark" class="dd-item
        
        
        
        ">
      <a href="/bigdata/spark/">
          Spark
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'></a> > <a href='/bigdata/'>大数据</a> > Hadoop
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#hadoop系统简介">Hadoop系统简介</a></li>
        <li><a href="#hadoop-生态圈">Hadoop 生态圈</a></li>
        <li><a href="#hdfs">HDFS</a></li>
        <li><a href="#mapreduce">MapReduce</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Hadoop
            </h1>
          

        



	<h3 id="hadoop系统简介">Hadoop系统简介</h3>
<p>      Hadoop 是一种分析和处理大数据的软件平台，是一个用 Java 语言实现的 Apache 的开源软件框架，在大量计算机组成的集群中实现了对海量数据的分布式计算。</p>
<p>      Hadoop 采用 MapReduce 分布式计算框架，根据 GFS 原理开发了 HDFS（分布式文件系统），并根据 BigTable 原理开发了 HBase 数据存储系统。</p>
<p>      Hadoop 和 Google 内部使用的分布式计算系统原理相同，其开源特性使其成为分布式计算系统的事实上的国际标准。</p>
<p>      Yahoo、Facebook、Amazon，以及国内的百度、阿里巴巴等众多互联网公司都以 Hadoop 为基础搭建了自己的分布式计算系统。</p>
<p>      Hadoop 是一个基础框架，允许用简单的编程模型在计算机集群上对大型数据集进行分布式处理。它的设计规模从单一服务器到数千台机器，每个服务器都能提供本地计算和存储功能，框架本身提供的是计算机集群高可用的服务，不依靠硬件来提供高可用性。用户可以在不了解分布式底层细节的情况下，轻松地在 Hadoop 上开发和运行处理海量数据的应用程序。低成本、高可靠、高扩展、高有效、高容错等特性让 hadoop 成为最流行的大数据分析系统。</p>
<br>
<h3 id="hadoop-生态圈">Hadoop 生态圈</h3>
<img src="/images/hadoop.png">
<p>其中，HDFS是一个提供高可用的获取应用数据的分布式文件系统；MapReduce是一个并行处理大数据集的编程模型。</p>
<h3 id="hdfs">HDFS</h3>
<p><strong>两类节点</strong>：</p>
<ul>
<li>NameNode，名称节点      Master</li>
<li>DataNode，数据节点      Worker</li>
</ul>
<br>
<p>HDFS 总的设计思想是分而治之，即将大文件和大批量文件分布式存放在大量独立的服务器上，以便采取分而治之的方式对海量数据进行运算分析。</p>
<p>HDFS 是一个主/从体系结构，从最终用户的角度来看，它就像传统的文件系统一样，可以通过目录路径对文件执行 CRUD（Create、Read、Update 和 Delete）操作。但由于分布式存储的性质，HDFS 集群拥有一个 NameNode 和一些 DataNode。NameNode 管理文件系统的元数据，DataNode 存储实际的数据。</p>
<br>
<p>客户端通过联系 NameNode 来获取文件的元数据，而真正的文件 I/O 操作是直接和 DataNode 交互进行的。</p>
<p>HDFS 主要针对“<strong>一次写入，多次读取</strong>”的应用场景，不适合实时交互性很强的应用场景，也不适合存储大量小文件。</p>
<br>
<p><strong>HDFS的基本思想</strong></p>
<p>HDFS 是个抽象层，底层依赖很多独立的服务器，对外提供统一的文件管理功能。基本架构如图所示</p>
<img src="/images/HDFS_articture.png">
<p>例如，用户访问 HDFS 中的 /a/b/c.mpg 这个文件时，HDFS 负责从底层的相应服务器中读取该文件，然后返回给用户，这样用户就只需和 HDFS 打交道，而不用关心这个文件是如何存储的。</p>
<br>
<p>为了解决存储结点负载不均衡的问题，HDFS 首先把一个文件分割成多个块，然后再把这些文件块存储在不同服务器上。这种方式的优势就是不怕文件太大，并且读文件的压力不会全部集中在一台服务器上，从而可以避免某个热点文件会带来的单机负载过高的问题。</p>
<p>文件分块存储：</p>
<img src="/images/HDFS1.png">
<p>为了保证文件的可靠性，避免一台机器坏了导致丢失文件的情况，HDFS会把每个文件块进行多个备份，一般情况下是备份3份，如图所示：</p>
<img src="/images/HDFS_backup.png">
<p>采用分块多副本存储方式后，HDFS 文件的可靠性就大大增强了，即使某个服务器出现故障，也仍然可以完整读取文件，该方式同时还带来一个很大的好处，就是增加了文件的并发访问能力。例如，多个用户读取这个文件时，都要读取块 1，HDFS 可以根据服务器的繁忙程度，选择从哪台服务器读取块 1。</p>
<br>
<p>为了管理文件，HDFS 需要记录维护一些元数据，也就是关于文件数据信息的数据，如 HDFS 中存了哪些文件，文件被分成了哪些块，每个块被放在哪台服务器上等。</p>
<p>HDFS 把这些元数据抽象为一个目录树，来记录这些复杂的对应关系。这些元数据由一个单独的模块进行管理，这个模块叫作名称结点（NameNode）。存放文件块的真实服务器叫作数据结点（DataNode）。</p>
<br>
<p><strong>HDFS整体架构</strong></p>
<p>HDFS 是一个主从 Master/Slave 架构。一个 HDFS 集群包含一个 NameNode，这是一个 Master Server，用来管理文件系统的命名空间，以及调节客户端对文件的访问。一个 HDFS 集群还包括多个 DataNode，用来存储数据。</p>
<img src="/images/HDFS_2.png">
<p>HDFS 会对外暴露一个文件系统命名空间，并允许用户数据以文件的形式进行存储。在内部，一个文件被分成多个块并且这些块被存储在一组 DataNode 上。</p>
<p><strong>1）NameNode</strong></p>
<p>文件的元数据采用集中式存储方案存放在 NameNode 当中。NameNode 负责执行文件系统命名空间的操作，如打幵、关闭、重命名文件和目录。NameNode 同时也负责将数据块映射到对应的 DataNode 中。</p>
<p><strong>2） DataNode</strong></p>
<p>DataNode 是文件系统的工作结点。它们根据需要存储并检索数据块，并且定期向 NameNode 发送他们所存储的块的列表。文件数据块本身存储在不同的 DataNode 当中，DataNode 可以分布在不同机架上。</p>
<p>DataNode 负责服务文件系统客户端发出的读/写请求。DataNode 同时也负责接收 NameNode 的指令来进行数据块的创建、删除和复制。</p>
<p><strong>3）Client</strong></p>
<p>HDFS 的 Client 会分别访问 NameNode 和 DataNode 以获取文件的元信息及内容。HDFS 集群的 Client 将直接访问 NameNode 和 DataNode，相关数据会直接从 NameNode 或者 DataNode 传送到客户端。</p>
<p>NameNode 和 DataNode 都是被设计为在普通 PC 上运行的软件程序。HDFS 是用Java语言实现的，任何支持 Java 语言的机器都可以运行 NameNode 或者 DataNode。Java 语言本身的可移植性意味着 HDFS 可以被广泛地部署在不同的机器上。</p>
<p>一个典型的部署就是，集群中的一台专用机器运行 NameNode，集群中的其他机器每台运行一个 DataNode 实例。该架构并不排除在同一台机器上运行多个 DataNode 实例的可能，但在实际的部署中很少会这么做。</p>
<p><strong>单一 NameNode 的设计极大地简化了集群的系统架构，它使得所有 HDFS 元数据的仲裁和存储都由单一 NameNode 来决定，避免了数据不一致性的问题。</strong></p>
<br>
<p><strong>HDFS数据复制</strong></p>
<p>HDFS 可以跨机架、跨机器，可靠地存储海量文件。HDFS 把每个文件存储为一系列的数据块，<strong>除了最后一个数据块以外，一个文件的所有数据块都是相同大小的。</strong></p>
<p>为了容错，一个文件的数据块会被复制。对于每个文件来说，<strong>文件块大小和复制因子都是可配置的</strong>。应用程序可以声明一个文件的副本数。复制因子可以在文件创建时声明，并且可以在以后修改。</p>
<p>NameNode 控制所有的数据块的复制决策，如下图所示。它周期性地从集群中的 DataNode 中收集<strong>心跳和数据块报告</strong>。收集到心跳则意味着 DataNode 正在提供服务。收集到的数据块报告会包含相应 DataNode 上的所有数据块列表。</p>
<img src="/images/HDFS_BlockReplication.png">
<p>通用场景下，当复制因子是 3 时，HDFS 的放置策略是将一个副本放置到本地机架的一个结点上，另一个放在本地机架的不同结点上，最后一个放在不同机架的不同结点上。机架不可用的概率要比结点不可用的概率低很多，这一策略并不影响数据可靠性和可用性。</p>
<br>
<p>当一切运行正常时，DataNode 会周期性发送心跳信息给 NameNode（默认是每 3 秒钟一次）。如果 NameNode 在预定的时间内没有收到心跳信息（默认是 10 分钟），就会认为 DataNode 出现了问题，这时候就会把该 DataNode 从集群中移除，并且启动一个进程去恢复数据。DataNode 脱离集群的原因有多种，如硬件故障、主板故障、电源老化和网络故障等。</p>
<br>
<br>
<h3 id="mapreduce">MapReduce</h3>
<ul>
<li>
<p>Map</p>
<p>对集合中的每个元素进行同一个操作。如果想把表单里每个单元格乘以二，那么把这个函数单独地应用在每个单元格上的操作就属于映射（Map)。</p>
</li>
<li>
<p>Reduce</p>
</li>
</ul>
<p>​		遍历集合中的元素来返回一个综合的结果。如果想找出表单里所有数字的总和，那么输出表单里一列数字的总和的任务就属于化简（Reduce)。</p>
<br>
<p><strong>MapReduce基本思想</strong></p>
<ul>
<li>
<p>分而治之</p>
<p>并行计算的第一个重要问题是如何划分计算任务或者计算数据以便对划分的子任务或数据块同时进行计算。但是，一些计算问题的前后数据项之间存在很强的依赖关系，无法进行划分，只能串行计算。</p>
<p>对于不可拆分的计算任务或相互间有依赖关系的数据无法进行并行计算。一个大数据若可以分为具有同样计算过程的数据块，并且这些数据块之间不存在数据依赖关系，则提高处理速度的最好办法就是<strong>并行计算</strong>。</p>
<br>
</li>
<li>
<p>抽象模型：Map函数和Reduce函数</p>
<p>Map 函数对一组数据元素进行某种重复式的处理，Reduce 函数对 Map 函数的中间结果进行某种进一步的结果整理。</p>
<p><strong>1) Map:&lt;k1,v1&gt;List(&lt;K2,V2&gt;)</strong></p>
<p>输入：键值对&lt;k1,v1&gt;表示的数据。</p>
<p>处理：数据记录将以“键值对”形式传入 Map 函数；Map 函数将处理这些键值对，并以另一种键值对形式输出中间结果 List(&lt;K2,V2&gt;)。</p>
<p>输出：键值对List(&lt;K2,V2&gt;)示的一组中间数据。</p>
<p><strong>2) Reduce:&lt;K2,List(V2)&gt;→List(&lt;K3,V3&gt;)</strong></p>
<p>输入：由 Map 输出的一组键值对 List(&lt;K2,V2&gt;)将被进行合并处理，同样主键下的不同数值会合并到一个列表List(V2)中，故 Reduce 的输入为&lt;K2,List(V2)&gt;。</p>
<p>处理：对传入的中间结果列表数据进行某种整理或进一步的处理，并产生最终的输出结果List(&lt;K3,V3&gt;)。</p>
<p>输出：最终输出结果List(&lt;K3,V3&gt;)。</p>
<img src="/images/mAPrEDUCE.png">
<table>
<thead>
<tr>
<th>函数</th>
<th>输入</th>
<th>输出</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>Map</td>
<td>Map&lt;k1,V1&gt;</td>
<td>List(&lt;k1,V2&gt;)</td>
<td>将输入数据集分解成一批&lt;key,value&gt;对，然后进行处理；每一个&lt;key,value&gt;输入，Map 会输出一批&lt;K2,V2&gt;</td>
</tr>
<tr>
<td>Reduce</td>
<td>&lt;k2,List(V2)&gt;</td>
<td>&lt;K3,V3&gt;</td>
<td>MapReduce 框架会把 Map 的输出，按 key 归类为 &lt;K2,List(V2)&gt;。List(V2) 是一批属于同一个 K2 的 value</td>
</tr>
</tbody>
</table>
<br>
</li>
<li>
<p>并行自动化并隐藏底层细节</p>
<p>MapReduce 提供了一个统一的计算框架，来完成计算任务的划分和调度，数据的分布存储和划分，处理数据与计算任务的同步，结果数据的收集整理，系统通信、负载平衡、计算性能优化、系统结点出错检测和失效恢复处理等。</p>
<p>MapReduce 通过抽象模型和计算框架把需要做什么与具体怎么做分开了，为程序员提供了一个抽象和高层的编程接口和框架，程序员仅需要关心其应用层的具体计算问题，仅需编写少量的处理应用本身计算问题的程序代码。</p>
<p>与具体完成并行计算任务相关的诸多系统层细节被隐藏起来，交给计算框架去处理：从分布代码的执行，到大到数千个，小到单个的结点集群的自动调度使用。</p>
<p><strong>MapReduce 计算架构</strong>提供的主要功能包括以下几点。</p>
<p><strong>1）任务调度</strong></p>
<p>提交的一个计算作业（Job)将被划分为很多个计算任务（Tasks)。</p>
<p>任务调度功能主要负责为这些划分后的计算任务分配和调度计算结点（Map 结点或 Reduce 结点），同时负责监控这些结点的执行状态，以及 Map 结点执行的同步控制，也负责进行一些计算性能优化处理。例如，对最慢的计算任务采用多备份执行，选最快完成者作为结果。</p>
<p><strong>2）数据/程序互定位</strong></p>
<p>为了减少数据通信量，一个基本原则是本地化数据处理，即一个计算结点尽可能处理其本地磁盘上分布存储的数据，这实现了代码向数据的迁移。</p>
<p>当无法进行这种本地化数据处理时，再寻找其他可用结点并将数据从网络上传送给该结点（数据向代码迁移)，但将尽可能从数据所在的本地机架上寻找可用结点以减少通信延迟。</p>
<p><strong>3）出错处理</strong></p>
<p>在以低端商用服务器构成的大规模 MapReduce 计算集群中，结点硬件（主机、兹盘、内存等）出错和软件有缺陷是常态。因此，MapReduce 架构需要能检测并隔离出错结点，并调度分配新的结点接管出错结点的计算任务。</p>
<p><strong>4）分布式数据存储与文件管理</strong></p>
<p>海量数据处理需要一个良好的分布数据存储和文件管理系统作为支撑，该系统能够把海量数据分布存储在各个结点的本地磁盘上，但保持整个数据在逻辑上成为一个完整的数据文件。</p>
<p>为了提供数据存储容错机制，该系统还要提供数据块的多备份存储管理能力。</p>
<p><strong>5）Combiner 和 Partitioner</strong></p>
<p>为了减少数据通信开销，中间结果数据进入 Reduce 结点前需要进行<strong>合并（Combine）处理，即把具有同样主键的数据合并到一起避免重复传送</strong>。</p>
<p>一个 Reduce 结点所处理的数据可能会来自多个 Map 结点，因此，<strong>Map 结点输出的中间结果需使用一定的策略进行适当的划分（Partition）处理，保证相关数据发送到同一个 Reduce 结点上</strong>。</p>
<br>
</li>
</ul>
<p><strong>MapReduce架构</strong></p>
<img src="/images/MR_articture.png">
<p>Hadoop的MapReduce与HDFS集群架构：</p>
<img src="/images/HADOOP_MR_HDFS.png">
<br>
<p><strong>MapReduce工作流程</strong></p>
<img src="/images/MR_work.png">
<br>
<p><strong>WordCount</strong></p>
<ul>
<li>分割</li>
</ul>
<img src="/images/WC_SPLIT.png">
<ul>
<li>Map</li>
</ul>
<img src="/images/WC_Map.png">
<ul>
<li>Map端排序及Combine过程</li>
</ul>
<img src="/images/Map_Sort_Combine.png">
<ul>
<li>Reduce端排序及输出结果</li>
</ul>
<img src="/images/WC_Reduce.png">
<br>
<p><strong>MapReduce作业执行流程</strong></p>
<img src="/images/MapReduce_Procedure.png">
<ol>
<li>提交作业</li>
</ol>
<p>客户端向 JobTracker 提交作业。首先，用户需要将所有应该配置的参数根据需求配置好。作业提交之后，就会进入自动化执行。在这个过程中，用户只能监控程序的执行情况和强制中断作业，但是不能对作业的执行过程进行任何干预。提交作业的基本过程如下。</p>
<p>**1）**客户端通过 Runjob() 方法启动作业提交过程。</p>
<p>**2）**客户端通过 JobTracker 的 getNewJobId() 请求一个新的作业 ID。</p>
<p>**3）**客户端检查作业的输出说明，计算作业的输入分片等，如果有问题，就抛出异常，如果正常，就将运行作业所需的资源（如作业 Jar 文件，配置文件，计算所得的输入分片等）复制到一个以作业 ID 命名的目录中。</p>
<p>**4）**通过调用 JobTracker 的 submitjob() 方法告知作业准备执行。</p>
<ol start="2">
<li>初始化作业</li>
</ol>
<p>JobTracker 在 JobTracker 端开始初始化工作，包括在其内存里建立一系列数据结构，来记录这个 Job 的运行情况。</p>
<p>**1）**JobTracker 接收到对其 submitJob() 方法的调用后，就会把这个调用放入一个内部队列中，交由作业调度器进行调度。初始化主要是创建一个表示正在运行作业的对象，以便跟踪任务的状态和进程。</p>
<p>**2）**为了创建任务运行列表，作业调度器首先从 HDFS 中获取 JobClient 已计算好的输入分片信息，然后为每个分片创建一个 MapTask，并且创建 ReduceTask。</p>
<ol start="3">
<li>分配任务</li>
</ol>
<p>JobTracker 会向 HDFS 的 NameNode 询问有关数据在哪些文件里面，这些文件分别散落在哪些结点里面。JobTracker 需要按照“就近运行”原则分配任务。</p>
<p>TaskTracker 定期通过“心跳”与 JobTracker 进行通信，主要是告知 JobTracker 自身是否还存活，以及是否已经准备好运行新的任务等。</p>
<p>JobTracker 接收到心跳信息后，如果有待分配的任务，就会为 TaskTracker 分配一个任务，并将分配信息封装在心跳通信的返回值中返回给 TaskTracker。</p>
<p>对于 Map 任务，JobTracker 通常会选取一个距离其输入分片最近的 TaskTracker，对于 Reduce 任务，JobTracker 则无法考虑数据的本地化。</p>
<ol start="4">
<li>执行任务</li>
</ol>
<p>**1）**TaskTracker 分配到一个任务后，通过 HDFS 把作业的 Jar 文件复制到 TaskTracker 所在的文件系统，同时，TaskTracker 将应用程序所需要的全部文件从分布式缓存复制到本地磁盘。TaskTracker 为任务新建一个本地工作目录，并把 Jar 文件中的内容解压到这个文件夹中。</p>
<p>**2）**TaskTracker 启动一个新的 JVM 来运行每个任务（包括 Map 任务和 Reduce 任务），这样，JobClient 的 MapReduce 就不会影响 TaskTracker 守护进程。任务的子进程每隔几秒便告知父进程它的进度，直到任务完成。</p>
<ol start="5">
<li>进程和状态的更新</li>
</ol>
<p>一个作业和它的每个任务都有一个状态信息，包括作业或任务的运行状态，Map 任务和 Reduce 任务的进度，计数器值，状态消息或描述。任务在运行时，对其进度保持追踪。</p>
<p>这些消息通过一定的时间间隔由 ChildJVM 向 TaskTracker 汇聚，然后再向 JobTracker 汇聚。JobTracker 将产生一个表明所有运行作业及其任务状态的全局视图，用户可以通过 Web UI 进行查看。JobClient 通过每秒查询 JobTracker 来获得最新状态，并且输出到控制台上。</p>
<ol start="6">
<li>作业的完成</li>
</ol>
<p>当 JobTracker 接收到的这次作业的最后一个任务已经完成时，它会将 Job 的状态改为“successful”。当 JobClient 获取到作业的状态时，就知道该作业已经成功完成，然后 JobClient 打印信息告知用户作业已成功结束，最后从 Runjob() 方法返回。</p>
<br>
<p><strong>Shuffle过程</strong></p>
<p>Hadoop MapReduce 的 Shuffle 阶段是指<strong>从 Map 的输出开始，包括系统执行排序，以及传送 Map 输出到 Reduce 作为输入的过程</strong>。</p>
<p>排序阶段是指对 Map 端输出的 Key 进行排序的过程。不同的 Map 可能输出相同的 Key，相同的 Key 必须发送到同一个 Reduce 端处理。Shuffle 阶段可以分为 Map 端的 Shuffle 阶段和 Reduce 端的 Shuffle 阶段。</p>
<img src="/images/Shuffle.png"> 
<ol>
<li>Map 端的 Shuffle 阶段</li>
</ol>
<p><strong>1）<strong>每个输入分片会让一个 Map 任务来处理，默认情况下，以 HDFS 的一个块的大小（默认为 64MB）为一个分片。Map 函数开始产生输出时，并不是简单地把数据写到磁盘中，因为频繁的磁盘操作会导致性能严重下降。它的处理过程是把数据首先写到</strong>内存中的一个缓冲区</strong>， 并做一些<strong>预排序</strong>，以提升效率。</p>
<p>**2）**每个 Map 任务都有一个用来写入输出数据的循环内存缓冲区（默认大小为 100MB)，当缓冲区中的数据量达到一个特定阈值（默认是 80%）时，系统将会启动一个后台线程，<strong>把缓冲区中的内容写到磁盘中（即 Spilt阶段)</strong>。在写磁盘过程中，Map 输出继续被写到缓冲区中，但如果在此期间缓冲区被填满，那么 Map 任务就会阻塞直到写磁盘过程完成。</p>
<p><strong>3）在写磁盘前，线程首先根据数据最终要传递到的 Reduce 任务把数据划分成相应的分区（Partition）</strong>。在每个分区中，后台线程按 Key 进行排序，如果有一个 Combiner，便会在排序后的输出上运行。</p>
<p>**4）**一旦内存缓冲区达到溢出写的阈值，就会创建一个溢出写文件，因此在 Map 任务完成其最后一个输出记录后，便会有多个溢出写文件。<strong>在 Map 任务完成前，溢出写文件被合并成一个索引文件和数据文件（多路归并排序）（Sort 阶段)。</strong></p>
<p>**5）**溢出写文件归并完毕后，Map 任务将删除所有的临时溢出写文件，并告知 TaskTracker 任务已完成，<strong>只要其中一个 Map 任务完成，Reduce 任务就会开始复制它的输出（Copy 阶段)</strong>。</p>
<p>**6）**Map 任务的输出文件放置在运行 Map 任务的 TaskTracker 的本地磁盘上，它是运行 Reduce 任务的 TaskTracker 所需要的输入数据。</p>
<ol start="2">
<li>Reduce 端的 Shuffle 阶段</li>
</ol>
<p>**1）**Reduce 进程启动一些数据复制线程，<strong>请求 Map 任务所在的 TaskTracker 以获取输出文件（Copy 阶段）</strong>。</p>
<p>**2）**将 Map 端复制过来的数据先放入内存缓冲区中，Merge 有 3 种形式，分别是内存到内存，内存到磁盘，磁盘到磁盘。默认情况下，第一种形式不启用，第二种形式一直在运行（Spilt阶段），直到结束，第三种形式生成最终的文件（Merge 阶段）。</p>
<p>**3）**最终文件可能存在于磁盘中，也可能存在于内存中，但是默认情况下是位于磁盘中的。<strong>当 Reduce 的输入文件已定，整个 Shuffle 阶段就结束了</strong>，然后就是 Reduce 执行，把结果放到 HDFS 中（Reduce 阶段）。</p>
<br>





<footer class=" footline" >
	
</footer>

<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>